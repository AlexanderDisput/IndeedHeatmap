<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marketing Analytics Suite</title>
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-1: #eef5ff;
        --bg-2: #e8fff4;
        --ink: #122235;
        --muted: #506072;
        --line: rgba(18, 34, 53, 0.12);
        --accent: #0e7490;
        --accent-2: #16a34a;
        --glass: rgba(255, 255, 255, 0.78);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        min-height: 100%;
        font-family: "Sora", "Avenir Next", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(circle at 8% 12%, #d9e9ff 0%, transparent 32%),
          radial-gradient(circle at 85% 88%, #d9fbe8 0%, transparent 30%),
          linear-gradient(145deg, var(--bg-1), var(--bg-2));
      }

      .page {
        max-width: 1400px;
        margin: 0 auto;
        padding: 8px;
      }

      .shell {
        position: relative;
        backdrop-filter: blur(12px);
        background: var(--glass);
        border: 1px solid var(--line);
        border-radius: 20px;
        box-shadow: 0 20px 45px rgba(9, 24, 39, 0.16);
        overflow: visible;
      }

      .topbar {
        display: flex;
        gap: 10px 14px;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        border-bottom: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.86);
        overflow: hidden;
        max-height: 220px;
        opacity: 1;
        transform: translateY(0);
        transition:
          max-height 300ms ease,
          opacity 220ms ease,
          transform 300ms ease,
          padding 300ms ease,
          border-color 220ms ease;
      }

      .title {
        font-size: 0.92rem;
        font-weight: 700;
        letter-spacing: 0.02em;
      }

      .subtitle {
        font-size: 0.74rem;
        color: var(--muted);
        margin-top: 2px;
      }

      .support-link {
        margin-top: 4px;
        font-size: 0.74rem;
      }

      .support-link .support-btn {
        display: inline-block;
        background: #003A9B;
        color: #ffffff;
        border: 1px solid #002a70;
        border-radius: 9px;
        padding: 5px 9px;
        font-size: 0.74rem;
        font-weight: 700;
        text-decoration: none;
        transition: box-shadow 140ms ease, transform 140ms ease, background-color 140ms ease;
      }

      .support-link .support-btn:hover {
        background: #002f82;
        box-shadow: 0 6px 14px rgba(18, 34, 53, 0.2);
        transform: translateY(-1px);
      }

      .tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .shared-upload {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .shared-upload label {
        font-size: 0.77rem;
        font-weight: 700;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .shared-upload input[type="file"] {
        font: inherit;
        font-size: 0.76rem;
        background: #fff;
        border: 1px solid var(--line);
        border-radius: 9px;
        padding: 5px 7px;
      }

      .shared-upload select {
        font: inherit;
        font-size: 0.76rem;
        background: #003A9B;
        color: #ffffff;
        border: 1px solid #002a70;
        border-radius: 9px;
        padding: 5px 7px;
        font-weight: 700;
      }

      .shared-upload select:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 58, 155, 0.24);
      }

      .shared-status {
        font-size: 0.74rem;
        color: var(--muted);
        max-width: 210px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .tab {
        border: 1px solid var(--line);
        background: #fff;
        color: var(--ink);
        font: inherit;
        font-size: 0.8rem;
        font-weight: 600;
        padding: 7px 11px;
        border-radius: 999px;
        cursor: pointer;
        transition: transform 160ms ease, background-color 160ms ease, color 160ms ease, border-color 160ms ease;
      }

      .tab:hover {
        transform: translateY(-1px);
      }

      .tab.active {
        background: #003A9B;
        color: #fff;
        border-color: transparent;
      }

      .viewport {
        position: relative;
        height: calc(100vh - 140px);
        min-height: 620px;
      }

      .panel {
        position: absolute;
        inset: 0;
        opacity: 0;
        transform: translateY(14px) scale(0.992);
        pointer-events: none;
        transition: opacity 320ms ease, transform 320ms ease;
      }

      .panel.active {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
        background: #fff;
      }

      @media (max-width: 900px) {
        .topbar {
          flex-direction: column;
          align-items: flex-start;
        }

        .viewport {
          height: calc(100vh - 166px);
          min-height: 520px;
        }

      }
    </style>
  </head>
  <body>
    <div class="page">
      <section class="shell">
	        <header class="topbar">
	          <div>
	            <div id="suiteTitle" class="title">Marketing Analytics Suite</div>
	            <div id="suiteSubtitle" class="subtitle">Switch between tools without leaving the page</div>
              <div class="support-link">
                <a class="support-btn" href="https://mail.google.com/mail/?view=cm&fs=1&to=adisput@indeed.com&su=Bug%20Report%2FFeature%20request%20-%20Marketing%20Analytics%20Suite" target="_blank" rel="noopener noreferrer">Bug Report / Feature Request</a>
              </div>
	          </div>
	          <div class="shared-upload">
	            <label id="sharedCsvLabel" for="sharedCsv">Shared CSV</label>
	            <input id="sharedCsv" type="file" accept=".csv,text/csv" />
	            <span id="sharedStatus" class="shared-status">Loaded demo: demo-data.csv</span>
              <select id="languageSelector" aria-label="Language selector">
                <option value="en">EN</option>
                <option value="de">DE</option>
                <option value="fr">FR</option>
                <option value="es">ES</option>
                <option value="it">IT</option>
                <option value="nl">NL</option>
              </select>
	          </div>
	          <div class="tabs-row">
	            <nav class="tabs" aria-label="Feature navigation">
	              <button id="tabBudget" class="tab active" data-view="budget">Budget Efficiency</button>
	              <button id="tabHeatmap" class="tab" data-view="heatmap">Geo Heatmap</button>
	              <button id="tabScraper" class="tab" data-view="scraper">Intent Quadrant</button>
	            </nav>
	          </div>
	        </header>

        <main class="viewport">
          <section class="panel active" data-panel="budget">
            <iframe src="./budget-efficiency/index.html?embedded=1" title="Budget Efficiency"></iframe>
          </section>
          <section class="panel" data-panel="heatmap">
            <iframe src="./heatmap/index.html?embedded=1" title="Geo Heatmap"></iframe>
          </section>
          <section class="panel" data-panel="scraper">
            <iframe src="./scraper/index.html?embedded=1" title="Intent Quadrant"></iframe>
          </section>
        </main>
      </section>
    </div>

      <script src="./shared-demo-data.js"></script>
	    <script>
	      const SHARED_UPLOAD_MESSAGE = "shared-csv-upload";
        const UI_LANGUAGE_MESSAGE = "ui-language-changed";
        const translations = {
          en: {
            title: "Marketing Analytics Suite",
            subtitle: "Switch between tools without leaving the page",
            sharedCsv: "Shared CSV",
            statusNone: "No shared file selected.",
            statusLoaded: "Loaded",
            tabBudget: "Budget Efficiency",
            tabHeatmap: "Geo Heatmap",
            tabScraper: "Intent Quadrant"
          },
          de: {
            title: "Marketing-Analyse Suite",
            subtitle: "Zwischen Tools wechseln, ohne die Seite zu verlassen",
            sharedCsv: "Geteilte CSV",
            statusNone: "Keine geteilte Datei ausgewählt.",
            statusLoaded: "Geladen",
            tabBudget: "Budget-Effizienz",
            tabHeatmap: "Geo-Heatmap",
            tabScraper: "Intent-Quadrant"
          },
          fr: {
            title: "Suite d'analyse marketing",
            subtitle: "Passez d'un outil à l'autre sans quitter la page",
            sharedCsv: "CSV partagé",
            statusNone: "Aucun fichier partagé sélectionné.",
            statusLoaded: "Chargé",
            tabBudget: "Efficacité budget",
            tabHeatmap: "Heatmap géo",
            tabScraper: "Quadrant d'intention"
          },
          es: {
            title: "Suite de analítica de marketing",
            subtitle: "Cambia entre herramientas sin salir de la página",
            sharedCsv: "CSV compartido",
            statusNone: "No hay archivo compartido seleccionado.",
            statusLoaded: "Cargado",
            tabBudget: "Eficiencia de presupuesto",
            tabHeatmap: "Mapa de calor geo",
            tabScraper: "Cuadrante de intención"
          },
          it: {
            title: "Suite di analisi marketing",
            subtitle: "Passa tra gli strumenti senza lasciare la pagina",
            sharedCsv: "CSV condiviso",
            statusNone: "Nessun file condiviso selezionato.",
            statusLoaded: "Caricato",
            tabBudget: "Efficienza budget",
            tabHeatmap: "Mappa di calore geo",
            tabScraper: "Quadrante intenzione"
          },
          nl: {
            title: "Marketing Analyse Suite",
            subtitle: "Wissel tussen tools zonder de pagina te verlaten",
            sharedCsv: "Gedeelde CSV",
            statusNone: "Geen gedeeld bestand geselecteerd.",
            statusLoaded: "Geladen",
            tabBudget: "Budgetefficiëntie",
            tabHeatmap: "Geo-heatmap",
            tabScraper: "Intentie-kwadrant"
          }
        };
	      const tabs = Array.from(document.querySelectorAll(".tab"));
	      const panels = Array.from(document.querySelectorAll(".panel"));
	      const frames = Array.from(document.querySelectorAll("iframe"));
	      const sharedCsvInput = document.getElementById("sharedCsv");
	      const sharedStatus = document.getElementById("sharedStatus");
        const languageSelector = document.getElementById("languageSelector");
        let currentLanguage = "en";
	      let sharedFile = window.DEFAULT_SHARED_UPLOAD ? { ...window.DEFAULT_SHARED_UPLOAD } : null;

      function setActive(view) {
        tabs.forEach((tab) => tab.classList.toggle("active", tab.dataset.view === view));
        panels.forEach((panel) => panel.classList.toggle("active", panel.dataset.panel === view));
      }

      function sendSharedFile(targetWindow) {
        if (!sharedFile || !targetWindow) return;
        targetWindow.postMessage(
          {
            type: SHARED_UPLOAD_MESSAGE,
            payload: {
              name: sharedFile.name,
              text: sharedFile.text
            }
          },
          "*"
        );
      }

	      function broadcastSharedFile() {
	        frames.forEach((frame) => sendSharedFile(frame.contentWindow));
	      }

        function applyShellLanguage(lang) {
          const t = translations[lang] || translations.en;
          currentLanguage = lang;
          document.getElementById("suiteTitle").textContent = t.title;
          document.getElementById("suiteSubtitle").textContent = t.subtitle;
          document.getElementById("sharedCsvLabel").textContent = t.sharedCsv;
          document.getElementById("tabBudget").textContent = t.tabBudget;
          document.getElementById("tabHeatmap").textContent = t.tabHeatmap;
          document.getElementById("tabScraper").textContent = t.tabScraper;
          if (!sharedFile) {
            sharedStatus.textContent = t.statusNone;
          } else {
            sharedStatus.textContent = `${t.statusLoaded}: ${sharedFile.name}`;
          }
        }

        function sendLanguage(targetWindow) {
          if (!targetWindow) return;
          targetWindow.postMessage({ type: UI_LANGUAGE_MESSAGE, payload: { language: currentLanguage } }, "*");
        }

        function broadcastLanguage() {
          frames.forEach((frame) => sendLanguage(frame.contentWindow));
        }

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => setActive(tab.dataset.view));
      });

	      frames.forEach((frame) => {
	        frame.addEventListener("load", () => {
            sendSharedFile(frame.contentWindow);
            sendLanguage(frame.contentWindow);
          });
	      });

        languageSelector.addEventListener("change", () => {
          applyShellLanguage(languageSelector.value);
          broadcastLanguage();
        });

      sharedCsvInput.addEventListener("change", async (event) => {
	        const file = event.target.files && event.target.files[0];
	        if (!file) return;
	        const text = await file.text();
	        sharedFile = { name: file.name, text };
	        sharedStatus.textContent = `${(translations[currentLanguage] || translations.en).statusLoaded}: ${file.name}`;
	        broadcastSharedFile();
	      });

        applyShellLanguage("en");
        if (sharedFile) broadcastSharedFile();
	    </script>
  </body>
</html>
